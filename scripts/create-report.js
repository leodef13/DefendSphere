#!/usr/bin/env node

import fs from 'fs'
import path from 'path'
import { fileURLToPath } from 'url'

const __filename = fileURLToPath(import.meta.url)
const __dirname = path.dirname(__filename)

// –ü–æ–ª—É—á–∞–µ–º –∞—Ä–≥—É–º–µ–Ω—Ç—ã –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏
const args = process.argv.slice(2)
const reportName = args[0]
const author = args[1] || 'DefendSphere Team'

if (!reportName) {
  console.error('‚ùå –û—à–∏–±–∫–∞: –ù–µ —É–∫–∞–∑–∞–Ω–æ –Ω–∞–∑–≤–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞')
  console.log('–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: node create-report.js "–ù–∞–∑–≤–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞" [–∞–≤—Ç–æ—Ä]')
  console.log('–ü—Ä–∏–º–µ—Ä: node create-report.js "–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π" "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤"')
  process.exit(1)
}

// –°–æ–∑–¥–∞–µ–º –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è
const now = new Date()
const dateTime = now.toISOString().slice(0, 19).replace(/[-:]/g, '-').replace('T', '_')
const dateTimeReadable = now.toLocaleString('ru-RU', {
  year: 'numeric',
  month: '2-digit',
  day: '2-digit',
  hour: '2-digit',
  minute: '2-digit',
  second: '2-digit'
})

// –°–æ–∑–¥–∞–µ–º –∏–º—è —Ñ–∞–π–ª–∞
const fileName = `${reportName}_${dateTime}.md`
const reportsDir = path.join(__dirname, '..', 'reports')
const filePath = path.join(reportsDir, fileName)

// –°–æ–∑–¥–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –æ—Ç—á–µ—Ç–∞
const reportContent = `# ${reportName}

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** ${dateTimeReadable}  
**–í–µ—Ä—Å–∏—è:** 1.0.0  
**–ê–≤—Ç–æ—Ä:** ${author}  

## –û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏

[–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≥–æ, —á—Ç–æ —Ç—Ä–µ–±–æ–≤–∞–ª–æ—Å—å –≤—ã–ø–æ–ª–Ω–∏—Ç—å]

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- [ ] –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ 1
- [ ] –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ 2
- [ ] –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ 3

### –¶–µ–ª–∏:
- –¶–µ–ª—å 1
- –¶–µ–ª—å 2
- –¶–µ–ª—å 3

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è:
[–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–∏–Ω—è—Ç—ã—Ö –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π]

### –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:
- –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è 1
- –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è 2
- –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è 3

### –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
1. –®–∞–≥ 1
2. –®–∞–≥ 2
3. –®–∞–≥ 3

## –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã:
- \`path/to/new/file.js\` - –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è
- \`path/to/another/file.tsx\` - –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è

### –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
- \`path/to/modified/file.js\` - –æ–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- \`path/to/another/modified/file.tsx\` - –æ–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –£–¥–∞–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
- \`path/to/deleted/file.js\` - –ø—Ä–∏—á–∏–Ω–∞ —É–¥–∞–ª–µ–Ω–∏—è

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### Unit —Ç–µ—Å—Ç—ã:
- [ ] –¢–µ—Å—Ç 1
- [ ] –¢–µ—Å—Ç 2
- [ ] –¢–µ—Å—Ç 3

### Integration —Ç–µ—Å—Ç—ã:
- [ ] –¢–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ 1
- [ ] –¢–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ 2

### Manual —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ 1
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ 2
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ UI/UX

### Performance —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
- [ ] –¢–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ 1
- [ ] –¢–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ 2

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –î–æ—Å—Ç–∏–≥–Ω—É—Ç—ã–µ —Ü–µ–ª–∏:
- [ ] –¶–µ–ª—å 1 - –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞
- [ ] –¶–µ–ª—å 2 - –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞
- [ ] –¶–µ–ª—å 3 - –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞

### –ú–µ—Ç—Ä–∏–∫–∏:
- –ú–µ—Ç—Ä–∏–∫–∞ 1: –∑–Ω–∞—á–µ–Ω–∏–µ
- –ú–µ—Ç—Ä–∏–∫–∞ 2: –∑–Ω–∞—á–µ–Ω–∏–µ
- –ú–µ—Ç—Ä–∏–∫–∞ 3: –∑–Ω–∞—á–µ–Ω–∏–µ

### –°–∫—Ä–∏–Ω—à–æ—Ç—ã/–¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏:
[–°—Å—ã–ª–∫–∏ –Ω–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç—ã –∏–ª–∏ –¥–µ–º–æ]

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

### –ß—Ç–æ –ø–æ–ª—É—á–∏–ª–æ—Å—å:
[–û–ø–∏—Å–∞–Ω–∏–µ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤]

### –ü—Ä–æ–±–ª–µ–º—ã –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:
[–û–ø–∏—Å–∞–Ω–∏–µ –≤–æ–∑–Ω–∏–∫—à–∏—Ö –ø—Ä–æ–±–ª–µ–º –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π]

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ —Ä–∞–∑–≤–∏—Ç–∏—è:
[–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –¥–∞–ª—å–Ω–µ–π—à–µ–º—É —Ä–∞–∑–≤–∏—Ç–∏—é]

### –°–≤—è–∑–∞–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏:
- [–°–≤—è–∑–∞–Ω–Ω–∞—è –∑–∞–¥–∞—á–∞ 1](—Å—Å—ã–ª–∫–∞)
- [–°–≤—è–∑–∞–Ω–Ω–∞—è –∑–∞–¥–∞—á–∞ 2](—Å—Å—ã–ª–∫–∞)

---

**–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω–∏–π:**
- \`file1.js\` (–Ω–æ–≤—ã–π/–∏–∑–º–µ–Ω–µ–Ω/—É–¥–∞–ª–µ–Ω)
- \`file2.tsx\` (–Ω–æ–≤—ã–π/–∏–∑–º–µ–Ω–µ–Ω/—É–¥–∞–ª–µ–Ω)

**–ö–æ–º–º–∏—Ç—ã:**
- \`commit_hash\` - –æ–ø–∏—Å–∞–Ω–∏–µ –∫–æ–º–º–∏—Ç–∞
- \`commit_hash\` - –æ–ø–∏—Å–∞–Ω–∏–µ –∫–æ–º–º–∏—Ç–∞
`

// –°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é reports –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç
if (!fs.existsSync(reportsDir)) {
  fs.mkdirSync(reportsDir, { recursive: true })
}

// –ó–∞–ø–∏—Å—ã–≤–∞–µ–º —Ñ–∞–π–ª
fs.writeFileSync(filePath, reportContent, 'utf8')

console.log('‚úÖ –û—Ç—á–µ—Ç —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ!')
console.log(`üìÅ –§–∞–π–ª: ${fileName}`)
console.log(`üìç –ü—É—Ç—å: ${filePath}`)
console.log(`üë§ –ê–≤—Ç–æ—Ä: ${author}`)
console.log(`üìÖ –î–∞—Ç–∞: ${dateTimeReadable}`)
console.log('')
console.log('üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:')
console.log('1. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –æ—Ç—á–µ—Ç, –∑–∞–ø–æ–ª–Ω–∏–≤ –≤—Å–µ —Ä–∞–∑–¥–µ–ª—ã')
console.log('2. –î–æ–±–∞–≤—å—Ç–µ –æ—Ç—á–µ—Ç –≤ git: git add reports/')
console.log('3. –ó–∞–∫–æ–º–º–∏—Ç—å—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è: git commit -m "docs: Add report for [–Ω–∞–∑–≤–∞–Ω–∏–µ]"')
console.log('4. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π: git push origin main')